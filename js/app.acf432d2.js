(function(){"use strict";var e={2774:function(e,t,n){var o=n(9242),r=n(3396);function i(e,t,n,o,i,s){const a=(0,r.up)("Upload"),d=(0,r.up)("AddBookmarks"),l=(0,r.up)("Fixed");return(0,r.wg)(),(0,r.j4)(l,{style:{position:"absolute",width:"100%",height:"100%",top:"0",left:"0"}},{default:(0,r.w5)((()=>["Upload"==e.state.name?((0,r.wg)(),(0,r.j4)(a,{key:0,done:e.fileUpload},null,8,["done"])):(0,r.kq)("",!0),"Edit"==e.state.name?((0,r.wg)(),(0,r.j4)(d,{key:1,ref:"bmeditor",done:e.setBookmarks},null,8,["done"])):(0,r.kq)("",!0)])),_:1})}n(8858),n(1318),n(3228);var s=n(6133),a=n(7139);const d=e=>((0,r.dD)("data-v-acb570a6"),e=e(),(0,r.Cn)(),e),l={ref:"editor",class:"editor"},c={class:"preview",style:{padding:"1em"}},f=d((()=>(0,r._)("h2",{style:{"text-align":"center"}},"Preview",-1))),u={style:{opacity:.5}};function h(e,t,n,o,i,s){const d=(0,r.up)("TreeView");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",l,null,512),(0,r._)("div",c,[f,(0,r.Wm)(d,{nodes:e.bm,children:e=>e.children},{node:(0,r.w5)((e=>[(0,r._)("span",null,(0,a.zw)(e.node.title),1),(0,r.Uk)(),(0,r._)("span",u,"["+(0,a.zw)(("number"==typeof e.node.dest?"P. ":"*")+e.node.dest)+"]",1)])),_:1},8,["nodes","children"])]),(0,r._)("button",{class:"done_btn",onClick:t[0]||(t[0]=t=>e.done?.(e.bookmarks,e.bm))},"Show Result in new Tab")],64)}n(560);var p=n(4747),m=n(3451);class g{factory(){return(0,r.aZ)({name:"TreeView",props:{nodes:{type:Array,required:!0},children:{type:Function,required:!0}}})}}function D(){return v}const v=(new g).factory();var P=n(89);var F=n(7327);function b(e,t){let n=t.lookupMaybe(s.PDFName.of("First"),s.PDFDict);if(void 0==n)return;const o=[];while(void 0!=n){const t=n.lookupMaybe(s.PDFName.of("Title"),s.PDFString,s.PDFHexString),r=n.lookupMaybe(s.PDFName.of("Next"),s.PDFDict);let i=n.lookup(s.PDFName.of("Dest"));const a=n.lookup(s.PDFName.of("A"));if(a){const e=a.lookup(s.PDFName.of("S"));if(e!=s.PDFName.of("GoTo")){console.log("Not a GoTo action");continue}console.log(a),i=a.lookup(s.PDFName.of("D"))}let d;if(i instanceof s.PDFArray){const t=i.get(0);d=e.getPages().findIndex((e=>e.ref==t))+1}else d=i.asString();o.push({title:t.asString(),dest:d,children:b(e,n)}),n=r}return console.log(o),o}function y(e){const t=e.catalog.lookupMaybe(s.PDFName.of("Outlines"),s.PDFDict);if(void 0!==t)return b(e,t)}function x(e,t,n,o){const r=o||e.context.nextRef(),i=s.PDFDict.fromMapWithContext(n||new Map,e.context);if(e.context.assign(r,i),i.set(s.PDFName.of("Title"),s.PDFHexString.fromText(t.title)),t.children&&k(e,i,r,t.children),t.dest)if("number"===typeof t.dest){const n=s.PDFArray.withContext(e.context),o=e.getPages()[t.dest-1];n.push(o.ref),n.push(s.PDFName.of("Fit")),i.set(s.PDFName.of("Dest"),n)}else{const e=s.PDFString.of(t.dest);i.set(s.PDFName.of("Dest"),e)}return console.log(i.asMap()),r}function k(e,t,n,o){const r=[];for(let i=0;i<o.length;i++)r.push(e.context.nextRef());for(let i=0;i<o.length;i++){const t=o[i],a=new Map([[s.PDFName.of("Parent"),n],[s.PDFName.of("Prev"),r[i-1]],[s.PDFName.of("Next"),r[i+1]]]);0===i&&a.delete(s.PDFName.of("Prev")),i===o.length-1&&a.delete(s.PDFName.of("Next")),x(e,t,new Map(a),r[i])}t.set(s.PDFName.of("First"),r[0]),t.set(s.PDFName.of("Last"),r[r.length-1]),t.set(s.PDFName.of("Count"),s.PDFNumber.of(r.length))}function w(e,t){const n=e.context.nextRef(),o=s.PDFDict.fromMapWithContext(new Map,e.context);e.context.assign(n,o),t&&k(e,o,n,t),n&&e.catalog.set(s.PDFName.of("Outlines"),n)}const N=s.PDFName.of("Outlines"),_=s.PDFName.of("First"),O=s.PDFName.of("Next"),C=s.PDFName.of("Title"),T=s.PDFName.of("Dest");function*A(e,t){let n;if(void 0===t){const t=e.catalog.get(N),o=e.context.lookup(t);if(void 0===o)return;n=o.asMap().get(_)}else n=t;while(void 0!==n){const t=e.context.lookup(n);yield[n,t],n=t.get(O)}}class S{static parseOutline(e,t){const n=[];for(const[,o]of A(e,t))n.push(S.from(e,o));return n}static from(e,t){const n=t.get(_),o=void 0===n?[]:S.parseOutline(e,n);let r=t.get(C);r instanceof s.PDFRef&&(r=e.context.lookup(r));let i="Dest",a=t.get(T);return void 0===a&&(i="A",a=t.get(s.PDFName.of("A"))),new S(r.asString(),o,a?{type:i,dest:a}:void 0)}constructor(e,t=[],n){(0,F.Z)(this,"Title",void 0),(0,F.Z)(this,"Children",void 0),(0,F.Z)(this,"Dest",void 0),this.Title=e,this.Children=t,this.Dest=n}get hasChildren(){return 0!==this.Children.length}_toDict(e,t,n,o){const r=s.PDFDict.fromMapWithContext(new Map,e.context);if(r.set(C,s.PDFHexString.fromText(this.Title)),r.set(s.PDFName.Parent,t),n&&r.set(s.PDFName.of("Prev"),n),o&&r.set(s.PDFName.of("Next"),o),this.Dest){const t=this.Dest;let n,o;switch(t.type){case"Dest":r.set(s.PDFName.of("Dest"),t.dest);break;case"A":r.set(s.PDFName.of("A"),t.dest);break;case"Page":if(o=s.PDFArray.withContext(e.context),n="name"in t?null:e.getPages()[t.number-1],!n)break;o.push(n.ref),o.push(s.PDFName.of("Fit")),r.set(T,o);break;default:}}return r}setDestPage(e){return this.Dest={type:"Page",number:e},this}get repr(){const e=this.Dest;let t;return t=void 0===e?"Undefined":"Page"===e.type?"Page "+e.number:"Not Parsed",{name:this.Title,target:t}}}function M(e){const t={array:e,i:0,peek(){return e[this.i]},consume(){return e[this.i++]},get done(){return this.i>=this.array.length}};return t}function W(e,t=0){Array.isArray(e)&&(e=M(e));const n=[];while(!e.done){let o=e.peek();const r=o.trim();if(""==r||r.startsWith("%")){e.consume();continue}let i=0;while(" "===o.charAt(i))i++;if(i<t)return n;if(i>t){if(0===n.length)throw new Error("Root bookmark is undefined");n[n.length-1].Children.push(...W(e,i));continue}e.consume(),o=o.trim();const s=o.lastIndexOf(" ");let a,d;if(s>=0){const e=Number.parseInt(o.substring(s+1));isNaN(e)||(a=o.substring(0,s),d=e)}void 0!==a&&void 0!==d||(a=o,d=NaN),n.push(new S(a,[],{type:"Page",number:d}))}return n}function j(e,t=0){let n="";for(let o of e)n+=" ".repeat(t)+o.title,"string"===typeof o.dest?n+=" [*"+o.dest+"]\n":n+=" ["+o.dest+"]\n",o.children&&(n+=j(o.children,t+2));return n}function R(e,t={index:0,indent:0}){const n=[];while(t.index<e.length){const o=e[t.index],r=o.search(/\S/);if(-1==r){t.index++;continue}if(r<t.indent)return n;if(r>t.indent){const o=t.indent;t.indent=r;const i=R(e,t);t.indent=o,i.length>0?n[n.length-1].children=i:n.push(...i);continue}t.index++;const i=o.match(/^([^%].*)\[(.*)\]$/);i?i[2].startsWith("*")?n.push({title:i[1],dest:i[2].slice(1)}):n.push({title:i[1],dest:parseInt(i[2])}):!o.startsWith("%")&&o.trim().length>0&&n.push({title:o,dest:NaN})}return n}var U=(0,r.aZ)({name:"AddBookmarks",components:{TreeView:D()},props:{done:{type:Function}},data(){return{bookmarks:[],bm:[],editor:null}},methods:{setDefaultText(e){const t=y(e);let n=j(t);this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:n}})},editorUpdate(e){const t=e.state.doc.toJSON();e.docChanged&&(this.bm=R(t)||[],this.bookmarks=W(e.state.doc.toJSON()))}},mounted(){let e=new p.tk({parent:this.$refs.editor,extensions:[m.Xy,p.tk.updateListener.of(this.editorUpdate)]});this.editor=e,e.dom.style.height="100%",e.dom.style.width="100%",e.dispatch({changes:{from:0,to:e.state.doc.length,insert:"% Enter new bookmarks here.\n% Example:\nCover 1\nChap 1 3\n  Chap 1.1 4"}})}});const Z=(0,P.Z)(U,[["render",h],["__scopeId","data-v-acb570a6"]]);var $=Z;function E(e,t,n,o,i,s){return(0,r.wg)(),(0,r.iD)("div",{ref:"parent_div",style:(0,a.j5)(e.style)},[(0,r._)("div",{ref:"fixed",style:(0,a.j5)(e.innerStyle)},[(0,r.WI)(e.$slots,"default")],4)],4)}var H=(0,r.aZ)({name:"FixedSizeContainer",props:{style:[String,Object]},methods:{onResize(){let e=this.$refs.parent_div,t=this.$refs.fixed;e&&t&&(this.fHeight=e.clientHeight,this.fWidth=e.clientWidth)}},data(){return{fWidth:void 0,fHeight:void 0,observer:void 0}},computed:{innerStyle(){return{position:"absolute",top:0,left:0,width:void 0!==this.fWidth?this.fWidth+"px":void 0,height:void 0!==this.fHeight?this.fHeight+"px":void 0}}},mounted(){this.observer=new ResizeObserver((()=>this.onResize())),this.observer.observe(this.$refs.parent_div),requestAnimationFrame((()=>this.onResize()))},beforeUnmount(){this.observer?.disconnect(),this.observer=void 0}});const z=(0,P.Z)(H,[["render",E]]);var B=z;const I=e=>((0,r.dD)("data-v-53d2363a"),e=e(),(0,r.Cn)(),e),q={style:{width:"100%",height:"100%",padding:"2em"}},L=I((()=>(0,r._)("span",null,"Drop PDF here",-1))),V=[L];function G(e,t,n,o,i,s){return(0,r.wg)(),(0,r.iD)("div",q,[(0,r._)("div",{ref:"drop_target",class:"drop_target",onDragenter:t[0]||(t[0]=t=>e.dragStart(t)),onDragleave:t[1]||(t[1]=t=>e.dragEnd(t)),onDragend:t[2]||(t[2]=t=>e.dragEnd(t)),onDragover:t[3]||(t[3]=t=>e.dragOver(t)),onDrop:t[4]||(t[4]=t=>e.drop(t))},V,544)])}var J=(0,r.aZ)({name:"HelloWorld",props:{done:{type:Function}},methods:{dragStart(e){this.$refs.drop_target.style.color="green"},dragEnd(e){this.$refs.drop_target.style.color="",console.log("end")},dragOver(e){e.preventDefault()},drop(e){e.preventDefault();let t=e.dataTransfer?.files;if(void 0===t)return;if(1!==t.length)return;let n=t[0],o=this.$props.done,r=new FileReader;r.onload=function(){o?.({name:n.name,content:this.result})},r.readAsArrayBuffer(n)}}});const X=(0,P.Z)(J,[["render",G],["__scopeId","data-v-53d2363a"]]);var Y=X,K=(0,r.aZ)({name:"App",components:{AddBookmarks:$,Fixed:B,Upload:Y},data(){return{state:{name:"Upload"}}},methods:{fileUpload(e){s.PDFDocument.load(e.content).then((e=>{this.state={pdf:e,name:"Edit"},this.$nextTick((()=>this.$refs.bmeditor.setDefaultText(e)))})).catch((e=>console.error(e)))},async setBookmarks(e,t){let n=this.state;if("Edit"!==n.name)return;let o=n.pdf;w(o,t);let r=await o.save(),i=new Blob([r],{type:"application/pdf"}),s=URL.createObjectURL(i);window.open(s)}}});const Q=(0,P.Z)(K,[["render",i]]);var ee=Q;(0,o.ri)(ee).mount("#app")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,i){if(!o){var s=1/0;for(c=0;c<e.length;c++){o=e[c][0],r=e[c][1],i=e[c][2];for(var a=!0,d=0;d<o.length;d++)(!1&i||s>=i)&&Object.keys(n.O).every((function(e){return n.O[e](o[d])}))?o.splice(d--,1):(a=!1,i<s&&(s=i));if(a){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[o,r,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,i,s=o[0],a=o[1],d=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(d)var c=d(n)}for(t&&t(o);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(c)},o=self["webpackChunkpdf_bookmark_editor"]=self["webpackChunkpdf_bookmark_editor"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(2774)}));o=n.O(o)})();
//# sourceMappingURL=app.acf432d2.js.map